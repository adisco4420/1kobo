<ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
      <a (click)="navigateTab('home')" class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Active Plans</a>
    </li>
    <li class="nav-item" role="presentation">
      <a  (click)="navigateTab('newPlan')" class="nav-link" id="newPlan-tab" data-toggle="tab" href="#newPlan" role="tab" aria-controls="newPlan" aria-selected="false">New Plan</a>
    </li>
    <li class="nav-item" role="presentation">
      <a (click)="navigateTab('trans')" class="nav-link" id="trans-tab" data-toggle="tab" href="#trans" role="tab" aria-controls="trans" aria-selected="false">Transactions</a>
    </li>
  </ul>
  <div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
        <ng-container *ngIf="activeSavingsList; else loadingActiveSavings">
            <div class="row">
                <div class="col-md-12">
                    <div class="card bg-light">
                        <div class="card-body d-flex justify-content-between">
                            <div>
                                <h6>Savings Balance</h6>
                                <p>{{totalSavings ? (totalSavings | currency:'NGN':'symbol-narrow'): 0}}</p>
                            </div>
                            <div>
                                <i class="fa fa-piggy-bank fa-2x text-teal"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="card border-top-0">
                        <div class="card-body d-flex">
                            <div class="mr-3 border-right pr-3">
                                <h6>Interest Rate</h6>
                                <p>5-10% per month</p>
                            </div>
                            <div>
                                <div class="mr-3">
                                    <h6>Total</h6>
                                    <p>{{activeSavingsList.length}}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-4">
                <ng-container>
                    <div class="col-md-8" *ngIf="activeSavingsList.length; else noActiveSavings">
                        <app-savings-list  [activeSavingsList]="activeSavingsList" ></app-savings-list>
                    </div>
                    <ng-template #noActiveSavings>
                        <div class="col-md-4" >
                            <h6>Savings plan</h6>
                            <div class="card text-center cursor-pointer shadow-sm py-4"  (click)="navigateTab('newPlan')">
                                <div class="card-body">
                                    <i class="fa fa-plus-circle text-teal fa-2x"></i>
                                    <p>Add a plan</p>
                                </div>
                            </div>
                        </div>
                    </ng-template>
                </ng-container>
            </div>
        </ng-container>
        <ng-template #loadingActiveSavings>
            <div class="row">
                <div class="col-12 text-center">
                  <app-loader></app-loader>
                </div>
            </div>
        </ng-template>
      
    </div>

    <div class="tab-pane fade" id="newPlan" role="tabpanel" aria-labelledby="newPlan-tab">
        <div class="row mt-3 planTypes-row" *ngIf="showNewPlanCard==='first'">
            <div class="col-md-4" *ngFor="let planType of planTypes">
                <div class="card shadow-sm cursor-pointer" (click)="handleAddNewPlan(planType)" >
                    <div class="card-body text-white" [style.background]="planType.bgColor">
                        <h4 class="text-capitalize">{{planType.name + ' Plan'}}</h4>
                        <p>Save periodically: daily, weekly or monthly.</p>
                    </div>
                    <div class="card-footer border-0">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6>Min Amount: {{planType.minimumAmount | currency:'NGN':'symbol-narrow'}}</h6>
                                <h6>Min Duration: {{planType.minDur}} months</h6>
                            </div>
                            <div>
                               <h6> ROI: {{planType.interest}}% /month</h6>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- <div class="col-md-12">
                <div class="card">
                    <div class="card-body row">
                        <div class="col-md-8">
                            <h6>Periodic savings plan</h6>
                            <p>Save regularly (daily/weekly/monthly) & earn up to 8% per month. Withdraw once your savings has matured.</p>
                        </div>
                        <div class="col-md-4 text-right">
                            <button (click)="handleAddNewPlan()" class="btn pry-dark-bg">Add New <i class="fa fa-plus"></i></button>
                        </div>
                    </div>
                </div>
            </div>  -->
            <div class="col-md-12 mt-3 text-center">  
                <img src="/assets/images/people-saving2.png" width="400px" alt="img">
            </div>
        </div>
        <div class="row mt-3" *ngIf="showNewPlanCard==='second'" >
            <div class="col-md-6 offset-md-3">
                <div class="card shadow my-4" *ngIf="planType">
                    <div class="card-header text-capitalize text-center">
                        <h5>{{planType.name+ ' Plan'}}</h5>
                    </div>
                    <div class="card-body">
                        <form [formGroup]="form">
                            <div class="form-group">
                                <label>Plan name</label>
                                <input formControlName="name" type="text" class="form-control" placeholder="Enter plan name e.g school fees, house rent">
                                <div class="text-danger" *ngIf="getCtrl('name').touched && getCtrl('name').invalid">
                                    <span>*plan name is required</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-md-6">
                                    <label>How often?</label>
                                    <select formControlName="frequency" class="form-control">
                                        <option value="daily">Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly">Monthly</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-6">
                                    <label>How much do you want to save?</label>
                                    <input formControlName="amount" type="number" class="form-control" placeholder="Enter amount">
                                    <div class="text-danger" *ngIf="getCtrl('amount').touched && getCtrl('amount').invalid ">
                                        <span *ngIf="getCtrl('amount').errors.required">*amount is required</span>
                                        <span *ngIf="getCtrl('amount').errors.min">*minimum amount is {{getCtrl('amount').errors.min.min | currency:'NGN':'symbol-narrow'}}</span>
                                    </div>
                                </div>
                           
                            </div>
                            <div class="row">
                                <div class="form-group col-md-6">
                                    <label>How long do you want to save?</label>
                                    <select formControlName="duration" class="form-control">
                                        <option value="">Select duration</option>
                                        <option *ngFor="let dur of durationList" [value]="dur">{{dur+' '+durText}}</option>
                                    </select>
                                    <div class="text-danger" *ngIf="getCtrl('duration').touched && getCtrl('duration').invalid ">
                                        <span *ngIf="getCtrl('duration').errors.required">*duration is required</span>
                                        <span *ngIf="getCtrl('duration').errors.min">*minimum duration is {{getCtrl('duration').errors.min.min+' '+ durText}} </span>
                                    </div>
                                </div>
                                <div class="form-group col-md-6">
                                    <label>Start date</label>
                                    <input formControlName="startDate" [min]="minDate" type="date" class="form-control">
                                    <div class="text-danger" *ngIf="getCtrl('startDate').touched && getCtrl('startDate').invalid">
                                        <span>*start date is required</span>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="alert alert-success" role="alert">
                                    <div class="d-flex justify-content-between">
                                        <div class="titles">
                                            <p>Interest rate:</p>
                                            <p>Maturity date:</p>
                                            <p>Gross return:</p> 
                                        </div>
                                        <div  class="text-right">
                                            <h6>{{planType.interest}}% per month</h6>
                                            <h6>{{maturityDate ? (maturityDate | date): 'nil'}}</h6>
                                            <h5>{{totalInterest ? (totalInterest | currency:'NGN':'symbol-narrow'): 'nil'}}</h5>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <button [disabled]="form.invalid || loading" (click)="changeView('third')" type="button" class="btn pry-dark-bg btn-block"> <i class="fa fa-arrow-right"></i> Proceed  </button>
                            </div>
                            <div class="form-group">
                                <button (click)="handleCancelPlan()" class="btn btn-outline-danger btn-block"><i class="fa fa-arrow-left"></i> Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div> 
        <div class="row mt-3"  *ngIf="showNewPlanCard==='third'">
            <div class="col-md-5 offset-md-3">
                <div class="card savings-summary-card" *ngIf="planType">
                    <div class="card-body">
                        <div class="alert alert-info">
                            <h6><b>Withdrawal fee</b></h6>
                            <ul>
                                <li>withdrawals after 12 months - <b>1%</b> interest value.</li>
                                <li>withdrawals within 4-12 months - <b>1.5%</b> interest value.</li>
                                <li>withrawals within 1-4 months - <b>5.5%</b> interest value and you will also
                                    lose 1 month interest <b>({{planType?.interest || 5}}%).</b></li>
                            </ul>
                        </div>
                        <div class=" d-flex justify-content-between">
                            <div class="text-left">
                                <h6>Plan name</h6>
                                <h6>Amount</h6>
                                <h6>Start date</h6>
                                <h6>Maturity date</h6>
                                <h6>Interest value</h6>
                                <h6>Withdraw fee</h6>
                                <h6>Total return</h6>
                            </div>
                            <div class="text-right">
                                <h6><b>{{getFormValue('name')}}</b></h6>
                                <h6><b>
                                    <span>{{getFormValue('amount') | currency: 'NGN':'symbol-narrow'}}</span> /
                                    <span>{{getFormValue('frequency')}}</span>
                                </b></h6>
                                <h6><b>{{getFormValue('startDate') | date}}</b></h6>
                                <h6><b>{{maturityDate | date}}</b></h6>
                                <h6><b>{{(interestRate | currency: 'NGN':'symbol-narrow')}} | {{planType.interest+'%'}}</b></h6>
                                <h6><b>{{(withdrawFee * interestRate) | currency: 'NGN':'symbol-narrow'}}</b></h6> 
                                <h6><b>{{(totalInterest - (withdrawFee * interestRate) | currency: 'NGN':'symbol-narrow')}}</b></h6>
                            </div>
                        </div>
                        <div>
                            <div class="form-group">
                                <button [disabled]="form.invalid || loading" (click)="addPlan()" type="button" class="btn pry-dark-bg btn-block">  
                                    <span *ngIf="!loading">
                                        <span>Save </span>
                                        <span>{{getFormValue('amount') | currency: 'NGN':'symbol-narrow'}}</span> /
                                        <span>{{getFormValue('frequency')}}</span> 
                                    </span>
                                    <span *ngIf="loading">
                                        <span>Loading... <i class="fa fa-spinner fa-spin"></i> </span>
                                    </span>
                                </button>
                            </div>
                            <div class="form-group">
                                <button (click)="changeView('second')" class="btn btn-outline-danger btn-block"><i class="fa fa-arrow-left"></i> Cancel</button>
                            </div>
                        </div>
          
                 
                    </div>
                </div>
            </div>
        </div>
        <div class="row my-3" *ngIf="showNewPlanCard==='fourth'">
            <div class="col-md-5 offset-md-3">
                <div class="card" *ngIf="bankInfo">
                    <div class="card-body text-center">
                        <div class="my-3">
                            <i class="fa fa-check-circle text-success fa-3x"></i>
                        </div>
                        <div>
                            <p class="text-info">Activate plan by making a deposit of <b>{{bankInfo.amount | currency:'NGN':'symbol-narrow'}}</b> to the below bank account</p>
                            <h5><span class="text-muted">Bank Name:</span> Rubies Bank</h5>
                            <h5><span class="text-muted">Account Number:</span> {{bankInfo.virtualaccount}}</h5>
                            <h5><span class="text-muted">Account Name:</span> {{bankInfo.virtualaccountname}}</h5>
                        </div>
                        <div>
                            <button (click)="handleDone()" class=" btn pry-btn px-3">Done</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="tab-pane fade" id="trans" role="tabpanel" aria-labelledby="trans-tab">
        <div class="row mt-4"> 
            <div class="col-md-8" *ngIf="savingsList; else loadingSavingList">
                <app-savings-list [btnId]="'allSavingBtn'" [activeSavingsList]="savingsList" ></app-savings-list>
            </div>
            <ng-template #loadingSavingList>
                <div class="col-12 text-center">
                    <app-loader></app-loader>
                </div>
            </ng-template>  
        </div>
    </div>
  </div>